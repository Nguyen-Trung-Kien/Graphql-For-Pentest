All lab port swigger with graphql

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/150181a4-d54a-49ee-84f0-a745f8c5e745)


# Lab 1 - Lab: Accessing private GraphQL posts

Question: The blog page for this lab contains a hidden blog post that has a secret password. To solve the lab, find the hidden blog post and enter the password.

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/90f0ad8e-77fa-4b47-85c7-1b6b36913100)

1 trang khá đơn giản, các blog, thử truy cập vào trong từng bài , kiểm tra log, thấy rằng có requests gọi tới graphql

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/49b8ddca-f0fb-4418-98de-d04479c4b7f4)

Như bài trên thử fuzzing theo  cấp + blog

fuzzing 1-100 cũng ko có gì cả :))

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/ddccf646-0cf3-4235-a257-ff61c1bc7426)

xem requests thấy có path image: /image/blog/posts/68.jpg

thử từ image xem có gì, chà cũng ko có gì cả, thử các khác tìm instrospection có hidden nào k

thử query
```
{"query":"{__schema{types{name,fields{name}}}}"}
```
ồ, có getallblogpost

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/55aeaf60-eb22-463b-aab1-4d20771e7ab3)

Không check ra được gì, thử kiểm tra lại

Kiểm tra instrospection có postPassword

thử thêm vào và fuzzing lại


![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/882e0905-2745-42da-936a-50217e304d76)

ở post 3 có password

# Lab 2 - Lab: Accidental exposure of private GraphQL fields

question: The user management functions for this lab are powered by a GraphQL endpoint. The lab contains an access control vulnerability whereby you can induce the API to reveal user credential fields.

To solve the lab, sign in as the administrator and delete the username carlos.

Trang blog có đăng nhập
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/d7e94947-0c99-4e66-bcef-f5861ab09874)

Kiểm tra instrospection

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/ab008bbd-b52f-41af-8fa2-0a0f2d8fa983)

có username/password và hàm getUser, thử kiểm tra,

thay đổi

```

{"query":"\n    query getUser($id: Int!) {\n        getUser(id: $id) {\n            username\n            password\n          }\n    }","operationName":"getUser","variables":{"id":1}}
```

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/305fc02e-4afd-4a4a-908c-1412cb07ab86)

có username/pasword

có thể requests như sau
```
{
    "query": "{ getUser(id: 1) { username, password } }"
}
```


# Lab3 - Lab: Finding a hidden GraphQL endpoint

question: The user management functions for this lab are powered by a hidden GraphQL endpoint. You won't be able to find this endpoint by simply clicking pages in the site. The endpoint also has some defenses against introspection.

To solve the lab, find the hidden endpoint and delete carlos.

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/5f53f152-af6c-4d14-88dc-82fd0d4c15dd)

1 trang bán hàng, kiểm tra instrospection

Thư các chức năng nhưng cũng không có graphql, tìm đường dẫn thử /graphql 

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/8b3e05c6-3710-4ee5-98f6-a61c34ac627b)

fuzzing ra api thử introspection nhưng đã disabled

Thử thêm %0a ở sau __schema

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/4f48ef36-314d-4062-a901-1641faec3310)

Nó hoạt động, xem các query của trang web này

```
       {
          "name": "query",
          "fields": [
            {
              "name": "getUser"
            }
          ]
        }
```
có mục get user 

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/966ac9e3-c46c-4aba-8673-d226ac940340)

Thông báo lỗi trả về thếu iD, vậy ta thêm id vào

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/44229e87-886b-46b2-813a-d08ac38ebab4)
id 1 là administrator

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/5a7c717a-9160-44e7-9d51-e852684b36f4)

id 3 là carlos, 

xem lại trong introspection có thêm mutations deleteOrganizationUser, có thể sử dụng mutations này để xoá user có id là 3

sử dụng Fragments để kiểm tra các input có thể nhập vào

thấy được rằng input của mutations là id

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/fe37ebcf-d3f7-418b-86a3-c720e60bce96)

Thực hiện việc xoá user

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/855804e5-570d-4ba6-b0dd-33a92f26cfd7)

1 số lỗi trước khi có thể xoá thành công
1. mutation NOT mutations (tôi ghi sai , dư chữ s)
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/379a14b5-156c-4c53-8803-e1d650f02599)

2. id underfined tôi hiểu ra rằng cần phải truy vào 1 trường trong type DeleteOrganizationUserResponse
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/c2f8a037-2ddb-4700-bc16-e699783a5bf8)

3. Tôi xoá id thì yêu cầu 1 trường nằm trong type đó
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/f8e83d6d-f5c9-4ae1-96dc-c6c697efe85a)

4. Tôi thêm phản hồi trả về success nếu thành công nhưng lỗi giống như ở phần 2 success không đúng
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/05a5e2f0-93b4-4a59-bffa-c071c883de0f)

5. tôi xem lại introspection và thấy rằng 1 trường là user trong type  DeleteOrganizationUserResponse tôi thử thêm trường này vào
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/09f171df-7f11-48a7-ae25-003d69681c90)
Ồ phản hồi này không giống ở các lỗi trên, có vẻ như non-null, vậy thêm giá trị vào, thêm id
6. thành công 
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/7a247ec0-fa35-4ed3-9eb8-f75d78b6909f)

# Lab 4 - Lab: Bypassing GraphQL brute force protections
Question: The user login mechanism for this lab is powered by a GraphQL API. The API endpoint has a rate limiter that returns an error if it receives too many requests from the same origin in a short space of time.

To solve the lab, brute force the login mechanism to sign in as carlos. Use the list of authentication lab passwords as your password source.

Trang đăng nhập với tư cách là carlos

thử brutefoce
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/cebbbf14-5d96-4cea-99c8-1f230db581c2)

Ồ mỗi lần requests thì phải sau 1 phút mới nhập mật khẩu được

Thử introspection

 Ồ tôi thấy có blog sau chỉ có cách bypass bằng LOTS

 https://lachlan.nz/blog/bypassing-brute-force-protections-with-graphql/

 Tham khảo

 Tức là có thể thêm nhiều dữ liệu vào 1 trường  rồi gửi requests

 Thử đoạn script mà phía portswigger đưa sẵn ta nhận được
```
copy(`123456,password,12345678,qwerty,123456789,12345,1234,111111,1234567,dragon,123123,baseball,abc123,football,monkey,letmein,shadow,master,666666,qwertyuiop,123321,mustang,1234567890,michael,654321,superman,1qaz2wsx,7777777,121212,000000,qazwsx,123qwe,killer,trustno1,jordan,jennifer,zxcvbnm,asdfgh,hunter,buster,soccer,harley,batman,andrew,tigger,sunshine,iloveyou,2000,charlie,robert,thomas,hockey,ranger,daniel,starwars,klaster,112233,george,computer,michelle,jessica,pepper,1111,zxcvbn,555555,11111111,131313,freedom,777777,pass,maggie,159753,aaaaaa,ginger,princess,joshua,cheese,amanda,summer,love,ashley,nicole,chelsea,biteme,matthew,access,yankees,987654321,dallas,austin,thunder,taylor,matrix,mobilemail,mom,monitor,monitoring,montana,moon,moscow`.split(',').map((element,index)=>`
bruteforce$index:login(input:{password: "$password", username: "carlos"}) {
        token
        success
    }
`.replaceAll('$index',index).replaceAll('$password',element)).join('\n'));console.log("The query has been copied to your clipboard.");
```

đoạn script khá dễ để dựng lại

đầu vào trong graphql
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/9504d1df-8e56-40d4-b92a-2d6e16462faa)

có vẻ là thiếu gì đó, có thể thấy ràng opera name login chưưa được biết vậy thêm login ở mutation

chỉnh sửa 1 chút và thử 3 4 tài khoản
 ![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/8a1a4f6c-6bce-459c-993d-c515dbd21062)

nó đã hoạt động, 

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/1476c925-9f8b-45eb-98ba-ebe48180c281)

lấy được thành công

# Lab 5 - Lab: Performing CSRF exploits over GraphQL

question: The user management functions for this lab are powered by a GraphQL endpoint. The endpoint accepts requests with a content-type of x-www-form-urlencoded and is therefore vulnerable to cross-site request forgery (CSRF) attacks.

To solve the lab, craft some HTML that uses a CSRF attack to change the viewer's email address, then upload it to your exploit server.

You can log in to your own account using the following credentials: wiener:peter.

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/22996ae5-df86-4b6d-ba13-e98fd47d8ec1)
1 trang blog có thể đăng nhập

bài lab này là csrf, thử search trên hackerone 

1 bài khá hay exploit gitlab

https://hackerone.com/reports/1122408

requests change email đã có

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/8c6352c4-0587-4031-8b03-c30de379a212)

ở đây không có csrf token hoặc có gì để chặn csrf cả, nên có thể thử

tại sao chấp nhận x-www-form-urlencoded lại dễ csrf

![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/3d980fd4-3411-43ae-803e-5b2dc42ce06b)

thử như sau
![image](https://github.com/Nguyen-Trung-Kien/Graphql-For-Pentest/assets/65381453/67c90d17-05cc-451c-b02d-614e007340eb)

có vẻ chạy được :v 

GEN CSRF ->  copy body bỏ vào exploit và gửi cho victim

